<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="test.app.mybatis.mapperL.PayMapper">
	<select id="monthsale" resultType="int" parameterType="hashmap">
		select NVL(sum(pay),0) from payment where substr(pay_day,1,2)=#{year} and substr(pay_day,4,2)=#{month}
	</select>
	<select id="periodsale" resultType="int" parameterType="hashmap">
		select NVL(sum(pay),0) from payment 
		<![CDATA[where pay_day >= #{startday} and pay_day <= #{endday}]]>
	</select>
	<select id="memberslist" resultType="hashmap">
		select 
			mid,
			rpad(substr(mpwd,0,2),length(mpwd),'*') as mpwd,
			mname,
			mphone,
			memail,
			to_char(mregdate,'yyyy-mm-dd') as mregdate,
			mpoint,
			gname
		from 
			members m, grade g
		where
			m.gnum=g.gnum
	</select>
	
	<select id="companycount" resultType="int" parameterType="hashmap">
		select NVL(count(*),0) from house
		<if test="company!='20' and company!=null">
			where bnum=#{company}
		</if>
	</select>
	<select id="chartcount" resultType="hashmap">
		select bnum,count(bnum) as cnt from house 
		group by bnum 
		order by bnum
	</select>
	<select id="statics" parameterType="hashmap" resultType="hashmap">
		select nvl(sum(pay),0) as pay, to_char(pay_day,'YYYY/MM') as pay_day, LTRIM(substr(to_char(pay_day,'YYYY/MM'),6,2),'0') as month
		from payment 
		<![CDATA[where pay_day>=#{year}||'-01-01' and pay_day<#{years}||'-01-01']]>
		group by to_char(pay_day,'YYYY/MM')
		order by pay_day
	</select>
</mapper>














